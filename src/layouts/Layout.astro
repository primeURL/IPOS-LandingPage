---
import { SEO } from "astro-seo";
import '../styles/global.css';

interface Props {
  title?: string;
  description?: string;
  image?: string;
  noindex?: boolean;
}

const {
  title = "Interview Prep OS - Master Technical Interviews with AI-Powered Planning",
  description = "Transform your interview preparation with IPOS - an intelligent platform featuring automated study plans, progress tracking, spaced repetition, and personalized learning paths for technical interviews.",
  image = "/images/og-image.jpg",
  noindex = false
} = Astro.props;

const siteUrl = import.meta.env.PUBLIC_SITE_URL || 'https://ipos.dev';
const canonicalURL = new URL(Astro.url.pathname, siteUrl);
---

<!doctype html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="canonical" href={canonicalURL} />
    
    <!-- Preconnect to important domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
    
    <SEO
      title={title}
      description={description}
      canonical={canonicalURL.toString()}
      noindex={noindex}
      nofollow={noindex}
      openGraph={{
        basic: {
          title: title,
          type: "website",
          image: new URL(image, siteUrl).toString(),
          url: canonicalURL.toString(),
        },
        optional: {
          description: description,
          siteName: "Interview Prep OS",
        },
        image: {
          url: new URL(image, siteUrl).toString(),
          secureUrl: new URL(image, siteUrl).toString(),
          type: "image/jpeg",
          width: 1200,
          height: 630,
          alt: title,
        },
      }}
      twitter={{
        card: "summary_large_image",
        site: "@ipos_dev",
        creator: "@ipos_dev",
        title: title,
        description: description,
        image: new URL(image, siteUrl).toString(),
        imageAlt: title,
      }}
      extend={{
        meta: [
          { name: "twitter:image", content: new URL(image, siteUrl).toString() },
          { name: "twitter:title", content: title },
          { name: "twitter:description", content: description },
          { name: "theme-color", content: "#6366f1" },
          { name: "apple-mobile-web-app-capable", content: "yes" },
          { name: "apple-mobile-web-app-status-bar-style", content: "black-translucent" },
        ],
      }}
    />

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Interview Prep OS",
      "applicationCategory": "EducationalApplication",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "description": description,
      "operatingSystem": "Web",
      "url": siteUrl,
      "screenshot": new URL(image, siteUrl).toString(),
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "ratingCount": "1250"
      }
    })} />

    <meta name="generator" content={Astro.generator} />
  </head>
  <body class="bg-gradient-to-br from-slate-950 via-indigo-950 to-slate-900 text-white antialiased">
    <slot />
    
    <!-- Performance optimization: Defer non-critical scripts -->
    <script is:inline>
      // Smooth scroll polyfill for older browsers
      if (!('scrollBehavior' in document.documentElement.style)) {
        import('https://cdn.jsdelivr.net/npm/smoothscroll-polyfill@0.4.4/dist/smoothscroll.min.js')
          .then(module => module.polyfill());
      }
    </script>
  </body>
</html>
